<% if @user_latitude == nil %>

<% end %>

<form action="/"></form>
<h2>logout</h2>
<h1>My Events</h1>
  
<%

  @events = @events.map { |event|
    if (event.place.latitude.to_f - @user_latitude)**2 + (event.place.longitude.to_f - @user_longitude)**2 < @radius**2
      event
    end
  }.compact
  @events = @events.sort_by{ |event|
    (event.place.latitude.to_f - @user_latitude)**2 + (event.place.longitude.to_f - @user_longitude)**2
  }
  @events.each do |event|
%>

  <div class="events__item">
    <div class="events__image" style="background: url('<%= event.image_url %>'); height: 200px; width: 400px;"></div>
    <h3 class="events__title"><%= event.name %></h3>
    <% if !!event.description %>
      <p class="events__description"><%= event.description[0..200] %>...</p>
    <% end %>
    <div class="events__place">
      <p class="events__place__item"><%= event.place.name %></p> <p class="events__place__item"><%= 
      distance = (Math.sqrt((event.place.latitude.to_f - @user_latitude)**2 + (event.place.longitude.to_f - @user_longitude)) * 10000) ** 1.11333
      if distance < 1000
        distance.to_i
      else
        distance.to_i
      end
         %>m</p>
    </div>
  </div>
  
 -->  <% end %>
  
  <form id="search-form">
    Find events within
    <input type="number" min='100' max='20000' name="radius" id='radius'> meters.
    <button id="search-location">Find!</button>
  </form>