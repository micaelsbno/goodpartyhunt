<% if @user_latitude == nil %>

<% end %>

<h2>Event Search!</h2>
  
<%

  @events = @events.map { |event|
    if (event.place.latitude.to_f - @user_latitude)**2 + (event.place.longitude.to_f - @user_longitude)**2 < @radius**2 && !event.users.map { |user| user.id }.include?(current_user.id) 
      event
    end
  }.compact
  @events = @events.sort_by{ |event|
    (event.place.latitude.to_f - @user_latitude)**2 + (event.place.longitude.to_f - @user_longitude)**2
  }
  @events.each do |event|
%>

  <div class="events__item">
    <div class="events__image" style="background: url('<%= event.image_url %>'); height: 200px; width: 400px;">
      <div class="events__image__button">
        <form action="/search" method="post">
          <input type="hidden" name="event_id" value="<%= event.id %>">
          +
        </form>
      </div>
    </div>
    <h3 class="events__title"><%= event.name %></h3>
    <% if !!event.description %>
      <p class="events__description"><%= event.description[0..200] %>...</p>
    <% end %>
    <div class="events__place">
      <p class="events__place__item"><%= event.place.name %></p> <p class="events__place__item"><%= 
        dist = (event.place.latitude.to_f - @user_latitude)**2 + (event.place.longitude.to_f - @user_longitude)
      distance = (Math.sqrt(dist.abs) / 10000) ** 2
      if distance < 1000
        distance.to_i
      else
        distance.to_i
      end
         %>m</p>
    </div>
  </div>
  
 -->  <% end %>
  
  <form id="search-form">
    Find events within
    <input type="number" min='100' max='20000' name="radius" id='radius'> meters.
    <button id="search-location">Find!</button>
  </form>